(function(a){if(!Array.prototype.filter){Array.prototype.filter=function(q){if(this===void 0||this===null){throw new TypeError()}var u=Object(this);var o=u.length>>>0;if(typeof q!=="function"){throw new TypeError()}var s=[];var p=arguments.length>=2?arguments[1]:void 0;for(var r=0;r<o;r++){if(r in u){var v=u[r];if(q.call(p,v,r,u)){s.push(v)}}}return s}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(q,r){var p;if(this==null){throw new TypeError('"this" is null or not defined')}var t=Object(this);var o=t.length>>>0;if(o===0){return -1}var u=+r||0;if(Math.abs(u)===Infinity){u=0}if(u>=o){return -1}p=Math.max(u>=0?u:o-Math.abs(u),0);while(p<o){var s;if(p in t&&t[p]===q){return p}p++}return -1}}var c=["dale_group_topic_new_top_right","dale_group_topic_new_bottom_right","dale_group_topic_bottom_super_banner","dale_movie_subject_bottom_super_banner","dale_online_discussion_top_right","dale_personal_note_middle_right","dale_personal_note_bottom_super_banner","dale_anonymous_home_page_bottom","dale_anonymous_home_page_middle_2","dale_music_programme_bottom","dale_newgroup_home_bottom_right_201211","dale_event_page_bottom_right","dale_people_photo_right_image","dale_group_search_top_right","dale_group_explore_bottom_right","dale_book_subject_bottom_super_banner","dale_newgroup_home_bottom_banner_haoye","dale_movie_subject_photo_middle_right_haoye","dale_event_subject_bottom_super_banner","dale_movie_subject_trailer_playing_bottom_right","dale_newgroup_home_bottom_banner_201211","dale_online_photo_top_right_haoye","dale_people_photo_bottom_super_banner","dale_online_subject_bottom_super_banner","dale_movie_tag_bottom_super_banner","dale_newgroup_explore_bottom_banner"];var j,k,i,d,n;j=(function(){var q,u,o,r,p,t,s,v;u=function(w,y,x){if(w.addEventListener){w.addEventListener(y,x,false)}else{if(w.attachEvent){w.attachEvent("on"+y,x)}else{w["on"+y]=x}}};o=function(y,w){w.parentNode.removeChild(w);a[y]=undefined;try{delete a[y]}catch(x){}};r=function(y,z){var A="",w,x;for(w in y){if(y.hasOwnProperty(w)){w=z?encodeURIComponent(w):w;x=z?encodeURIComponent(y[w]):y[w];A+=w+"="+x+"&"}}return A.replace(/&$/,"")};p=function(){var z="",y=[],w="0123456789ABCDEF",x=0;for(x=0;x<32;x+=1){y[x]=w.charAt(Math.floor(Math.random()*16))}y[12]="4";y[16]=w.charAt((y[16]&3)|8);z="erebor_"+y.join("");return z};t=function(x,w){if(typeof x!=="undefined"){x(w)}};s=function(y,x,w){if(typeof y!=="undefined"){y(x,w)}};v=function(w){if(typeof w!=="undefined"){w()}};q={};q.get=function(z){z=z||{};var y=z.url,C=z.query||{},A=z.callbackParameter||"callback",D=p(),x=a.document.createElement("script"),w=a.document.getElementsByTagName("script")[0],B="?";if(typeof y==="undefined"){throw new Error("URL must be specified!")}C[A]=D;if(y.indexOf("?")>=0){B="&"}y+=B+r(C,true);a[D]=function(E){if(typeof E==="undefined"){t(z.error,"Invalid JSON data returned")}else{s(z.success,C,E)}o(D,x);v(z.complete)};x.setAttribute("src",y);w.parentNode.insertBefore(x,w);u(x,"error",function(){o(D,x);v(z.complete);t(z.error,"Error while trying to access the URL")})};return q})();var k=function(o){if(a.console){a.console.log(o)}};var d=function(o){while(o){if(o===a.document){return true}o=o.parentNode}return false};var i=function(o,r){var p=("toolbar=0,status=1,resizable=1,menubar=no,location=yes,scrollbars=yes"),q=a.window.open(o,r,p);if(q){q.focus()}return q};var b="";var f=(function(){var p="hidden";if(p in document){document.addEventListener("visibilitychange",o)}else{if((p="mozHidden") in document){document.addEventListener("mozvisibilitychange",o)}else{if((p="webkitHidden") in document){document.addEventListener("webkitvisibilitychange",o)}else{if((p="msHidden") in document){document.addEventListener("msvisibilitychange",o)}else{if("onfocusin" in document){document.onfocusin=document.onfocusout=o}else{window.onpageshow=window.onpagehide=window.onfocus=window.onblur=o}}}}}function o(r){var s="visible",t="hidden",q={focus:s,focusin:s,pageshow:s,blur:t,focusout:t,pagehide:t};r=r||window.event;if(r.type in q){b=q[r.type]}else{b=this[p]?"hidden":"visible"}}if(document[p]!==undefined){o({type:document[p]?"blur":"focus"})}})();var g=function(p){var q=$(p).offset().top;var o=q+parseInt(p.height);var s=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var r=document.documentElement.clientHeight;return((o>s)&&(q<(s+r)))};var l=function(){if(b==="hidden"||b==="blur"){return false}else{return true}};var m=function(q){var o=20;var p=setInterval(function(){e=document.getElementById(q+"_frame");if(e===null){clearInterval(p);return}var r=e.name;if(o>0&&r==="CPC"){if(l()&&g(e)){DoubanAdGet(q);o--}}else{clearInterval(p);p=0}},10000)};var h=a.DoubanAdSlots.sort().filter(function(o){return c.indexOf(o)!==-1});setTimeout(function(){for(var o=0;o<h.length;o++){m(h[o])}},0);var n=function(q,p){q=q||{};p=p||{};var o=q.unit||"",r=q.debug||false;err=p.msg,html=p.html||"",sellType=p.sell_type||"",width=p.width||0,height=p.height||0,margin=p.margin||"",debugHash=p.debug||"",adSlot=a.document.getElementById(o),adFrame=a.document.getElementById(o+"_frame");if(r&&(debugHash!=="")){i("http://ad.douban.com/debug/view/?er="+encodeURIComponent(debugHash))}if(typeof err!=="undefined"){return}if(!d(adSlot)){k("Cannot find slot "+o);return}if(!d(adFrame)){adFrame=a.document.createElement("iframe");adFrame.id=o+"_frame";adFrame.frameBorder=0;adFrame.scrolling="no";adFrame.style.overflow="hidden";adFrame.style.margin=margin;adFrame.width=width;adFrame.height=height;adSlot.appendChild(adFrame)}adFrame.name=sellType;adFrame.contentWindow.document.open();adFrame.contentWindow.document.write(html);adFrame.contentWindow.document.close()};a.DoubanAdGet=function(x,t){var q=a.DoubanAdRequest||{},x=x||[],t=t||{},o=q.src||"",v=q.uid||"",s=q.bid||"",w=q.ip||"",z=q.crtr||"",u=q.prv||"",p=q.debug||false,y=new Date().getTime(),C,A;if(typeof x==="string"){x=[x]}if(typeof t==="function"){var B=t;t={};for(var r=0;r<x.length;r++){t[x[r]]=B}}if(o===""){throw new Error("Ad service url must be specified!")}if(s===""){throw new Error("Browser id must be specified!")}if(u!==""){o=o+"preview/"}for(var r=0;r<x.length;r++){C=a.document.getElementById(x[r]);if(d(C)){A={unit:x[r],uid:v,bid:s,ip:w,crtr:z,ts:y,prv:u,debug:p};j.get({url:o,query:A,success:t[x[r]]||n,error:k})}else{k("Nonexistent slot "+x[r])}}};a.DoubanAdGet(a.DoubanAdSlots,a.DoubanAdLoaders)})(this);